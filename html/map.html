<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Demo Bản đồ Lừa Đảo Cyber Map</title>
  <style>
    body, html {
      margin: 0; padding: 0; overflow: hidden;
      background: #000;
      height: 100vh; width: 100vw;
      color: #0ff;
      font-family: monospace;
    }
    #globeViz {
      width: 100vw; height: 100vh;
      filter: drop-shadow(0 0 8px #0ff);
    }
  </style>
</head>
<body>
  <div id="globeViz"></div>

  <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
  <script src="https://unpkg.com/globe.gl"></script>

  <script>
    // Dữ liệu JSON mẫu: tọa độ điểm gửi và nhận (lat, lng)
    const routes = [
      { from: [10, 105], to: [21, 105] },
      { from: [21, 105], to: [16, 108] },
      { from: [16, 108], to: [10, 105] }
    ];

    // Khởi tạo Globe.gl
    const Globe = GlobeGL()
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
      .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
      .backgroundColor('#000000')
      .showGlobe(true)
      .showGraticules(true)
      .graticuleColor('#0f0')
      .globeMaterial(new THREE.MeshPhongMaterial({
        color: '#111',
        emissive: '#022',
        emissiveIntensity: 0.5,
        shininess: 5,
        transparent: true,
        opacity: 0.9
      }));

    // Gắn vào div
    const globeContainer = document.getElementById('globeViz');
    Globe(globeContainer);

    // Tạo group hiệu ứng tia bay
    const scene = Globe.scene();
    const arcGroup = new THREE.Group();
    scene.add(arcGroup);

    // Hàm tạo đường cong tia bay (Bezier) với hiệu ứng glow
    function createFlightArc(from, to) {
      const curve = new THREE.CubicBezierCurve3(
        new THREE.Vector3().setFromSphericalCoords(1, (90 - from[0]) * Math.PI / 180, from[1] * Math.PI / 180),
        new THREE.Vector3().setFromSphericalCoords(1.2, (90 - from[0]) * Math.PI / 180, from[1] * Math.PI / 180),
        new THREE.Vector3().setFromSphericalCoords(1.2, (90 - to[0]) * Math.PI / 180, to[1] * Math.PI / 180),
        new THREE.Vector3().setFromSphericalCoords(1, (90 - to[0]) * Math.PI / 180, to[1] * Math.PI / 180)
      );

      const points = curve.getPoints(50);
      const geometry = new THREE.BufferGeometry().setFromPoints(points);

      // Material phát sáng neon
      const material = new THREE.LineBasicMaterial({
        color: '#0ff',
        linewidth: 2,
        transparent: true,
        opacity: 0.7
      });

      const line = new THREE.Line(geometry, material);
      arcGroup.add(line);

      return line;
    }

    // Tạo và thêm các tia bay
    routes.forEach(({ from, to }) => {
      createFlightArc(from, to);
    });

    // Quay globe nhẹ
    (function animate() {
      Globe.rotation.y += 0.002;
      requestAnimationFrame(animate);
    })();
  </script>
</body>
</html>
